<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The London Free Press - FAQs</title>

    <meta name="chat-context-publication" content="London Free Press">
    <meta name="chat-context-page" content="FAQs">

    <style>
        /* --- GLOBAL STYLES (Newspaper Look) --- */
        body {
            margin: 0;
            font-family: 'Georgia', serif;
            background-color: #f4f4f4;
            color: #333;
        }

        /* HEADER */
        header {
            background-color: #000;
            color: #fff;
            padding: 15px 0;
            border-bottom: 4px solid #cc0000;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* NAVIGATION */
        nav {
            border-top: 1px solid #333;
            padding-top: 10px;
        }

        nav a {
            color: #fff;
            text-decoration: none;
            margin-right: 25px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
        }

        nav a:hover {
            color: #cc0000;
        }

        /* CONTENT LAYOUT */
        .main-content {
            background: #fff;
            margin-top: 20px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            min-height: 500px;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #111;
        }

        .article-meta {
            color: #888;
            font-size: 12px;
            font-family: Arial, sans-serif;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        p {
            line-height: 1.6;
            font-size: 18px;
            margin-bottom: 20px;
        }

        /* FOOTER */
        footer {
            background: #111;
            color: #777;
            padding: 40px 0;
            margin-top: 40px;
            text-align: center;
            font-family: Arial, sans-serif;
            font-size: 12px;
        }

        /* --- CHAT BUTTON STYLES --- */
        #endChatButton {
            display: none;
            position: fixed;
            bottom: 588px;
            right: 55px;
            z-index: 2147483647;
            padding: 4px 12px;
            background-color: #607d8b;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Arial', sans-serif;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        #endChatButton:hover {
            background-color: #455a64;
            transform: translateY(-1px);
        }

        #endChatButton:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* --- RESPONSIVE DESIGN --- */
        @supports (-webkit-touch-callout: none) {

            input,
            textarea {
                font-size: 16px !important;
            }
        }

        @media screen and (max-width: 480px) {
            #endChatButton {
                top: 65px;
                bottom: auto;
                right: 15px;
                padding: 4px 12px;
                font-size: 10px;
            }
        }
    </style>

    <script>
        !function (o, i, s, c) { var a, p, h, u = [], l = []; function e() { var t = "You must provide a supported major version."; try { if (!c) throw new Error(t); var e, n = "https://sdk.cxengage.net/webchat/2.6.11/", r = "serenovawebchat"; if ((e = "string" == typeof this.response ? JSON.parse(this.response) : this.response).url) { var o = i.getElementsByTagName("script")[0], s = i.createElement("script"); s.async = !0; var a = c.match(/([0-9]+)\.?([0-9]+)?\.?([0-9]+)?/), p = a && a[1]; if (a && a[3]) s.src = n + r + "." + c + ".min.js"; else { if (!(1 <= p && e["v" + p])) throw new Error(t); s.src = e["v" + p] } o.parentNode.insertBefore(s, o) } } catch (e) { e.message === t && console.error(e) } } o[s] = { init: function () { a = arguments; var t = { then: function (e) { return l.push({ type: "t", next: e }), t }, catch: function (e) { return l.push({ type: "c", next: e }), t } }; return t }, on: function () { u.push(arguments) }, render: function () { p = arguments }, destroy: function () { h = arguments } }, o.__onWebMessengerHostReady__ = function (e) { if (delete o.__onWebMessengerHostReady__, o[s] = e, a) for (var t = e.init.apply(e, a), n = 0; n < l.length; n++) { var r = l[n]; t = "t" === r.type ? t.then(r.next) : t.catch(r.next) } p && e.render.apply(e, p), h && e.destroy.apply(e, h); for (n = 0; n < u.length; n++)e.on.apply(e, u[n]) }; var t = new XMLHttpRequest; t.addEventListener("load", e), t.open("GET", "https://sdk.cxengage.net/webchat/2.6.11/loader.json", !0), t.responseType = "json", t.send() }(window, document, "SerenovaWebChat", "2");
    </script>
</head>

<body>

    <header>
        <div class="container">
            <div class="header-top">
                <div class="logo">The London Free Press</div>
            </div>
            <nav>
                <a href="index.html">Home</a>
                <a href="faqs.html">FAQs</a>
                <a href="subscription.html">Subscription</a>
            </nav>
        </div>
    </header>

    <div class="container main-content">
        <h1>Frequently Asked Questions</h1>

        <h3>How do I manage my subscription?</h3>
        <p>You can manage your subscription online by visiting the 'My Account' section or by calling our customer
            service line.</p>

        <h3>Where is my paper?</h3>
        <p>If your paper was not delivered by 6:00 AM, please report a delivery issue using our automated phone system.
        </p>

        <h3>How do I submit a Letter to the Editor?</h3>
        <p>Letters should be under 200 words. Please email them to letters@lfpress.com including your full name and
            phone number.</p>
    </div>

    <footer>
        <div class="container">
            &copy; 2026 Postmedia Network Inc. All rights reserved.<br>
            Unauthorized distribution, transmission or republication strictly prohibited.
        </div>
    </footer>

    <button id="endChatButton">End Chat</button>

    <script>
        // Global Configuration
        const CHAT_CONFIG = {
            integrationId: '695c04de46687020f97fed8b',
            storageType: 'sessionStorage'
        };

        let activeConversationId = null;
        const endChatBtn = document.getElementById('endChatButton');

        /**
         * 1. GET CONTEXT
         * Reads the <meta> tags from the <head> of the current HTML file.
         */
        function getPageContext() {
            const pubMeta = document.querySelector('meta[name="chat-context-publication"]');
            const pageMeta = document.querySelector('meta[name="chat-context-page"]');

            return {
                publication: pubMeta ? pubMeta.content : 'Unknown Publication',
                pageSource: pageMeta ? pageMeta.content : 'Unknown Page',
                url: window.location.href
            };
        }

        /**
         * 2. INIT CHAT
         * Initializes the SDK and sends the specific page data.
         */
        function initChatWidget() {
            if (typeof SerenovaWebChat === 'undefined') {
                setTimeout(initChatWidget, 100);
                return;
            }

            const options = {
                integrationId: CHAT_CONFIG.integrationId,
                canUserSeeConversationList: true,
                browserStorage: CHAT_CONFIG.storageType,
                customText: {
                    headerText: "How can I help?",  // Custom header text
                    prechatCaptureGreetingText: `Hi! I’m Postmedia’s virtual assistant.`,
                    prechatCaptureConfirmationText: `Thank you. How can I help you today?`,
                    notificationSettingsConnected: "",
                },

                prechatCapture: {

                    fields: [
                        {
                            type: 'text',
                            name: 'email',
                            label: 'To get started, please provide your email address:',
                            placeholder: 'your email',
                        },

                    ],
                },
                delegate: {
                    beforeDisplay: (message) => {
                        // Capture Conversation ID
                        if (message?.metadata?.conversationId) {
                            activeConversationId = message.metadata.conversationId;
                        }
                        return message;
                    }
                }
            };

            SerenovaWebChat.init(options).then(() => {
                console.log("SDK Initialized successfully.");

                // A. READ CONTEXT FROM META TAGS
                const context = getPageContext();
                console.log(`[Chat Context] Sending: ${context.pageSource} (${context.publication})`);

                // B. SEND CONTEXT TO AGENT
                SerenovaWebChat.updateUser({
                    properties: {
                        publication: context.publication,
                        pageSource: context.pageSource,
                        sourceUrl: context.url
                    }
                }).catch(err => console.error("Failed to update user properties:", err));

                // Inject CSS into the chat widget iframe to prevent iOS zoom on input focus
                const injectIframeStyles = () => {
                    const messengerIframe = document.getElementById('web-messenger-container');
                    if (messengerIframe) {
                        const iframeDoc = messengerIframe.contentDocument || messengerIframe.contentWindow.document;
                        if (iframeDoc && !iframeDoc.getElementById('ios-zoom-fix')) {
                            let zoomFix = iframeDoc.createElement('style');
                            zoomFix.id = 'ios-zoom-fix';
                            zoomFix.innerHTML = `@supports (-webkit-touch-callout: none) { input, textarea { font-size: 16px !important; } }`;
                            iframeDoc.head.appendChild(zoomFix);
                            console.log("[Chat Fix] iOS zoom fix injected into iframe.");
                        }
                    }
                };

                // Apply fix when widget is opened or loaded
                SerenovaWebChat.on('widget:opened', injectIframeStyles);
                injectIframeStyles(); // Try immediately as well

                // Show the "End Chat" button when the widget is open and hide it when closed
                SerenovaWebChat.on('widget:opened', () => endChatBtn.style.display = 'block');
                SerenovaWebChat.on('widget:closed', () => endChatBtn.style.display = 'none');
            });
        }

        /**
         * 3. END CHAT FUNCTIONALITY
         * Gracefully disconnects and resets the session.
         */
        function handleEndChat() {
            endChatBtn.innerText = "Ending...";
            endChatBtn.disabled = true;

            const performReset = () => {
                SerenovaWebChat.destroy();
                sessionStorage.clear();
                activeConversationId = null;
                endChatBtn.style.display = 'none';
                endChatBtn.innerText = "End Chat";
                endChatBtn.disabled = false;

                // Re-initialize for the next potential session
                setTimeout(initChatWidget, 1000);
            };

            if (activeConversationId) {
                // Send disconnect signal to backend
                SerenovaWebChat.sendMessage({
                    type: 'text',
                    text: 'disconnect-conversation',
                    metadata: { type: 'disconnect-conversation' }
                }, activeConversationId)
                    .then(() => setTimeout(performReset, 500))
                    .catch(() => performReset());
            } else {
                performReset();
            }
        }

        // Start execution when DOM is ready
        document.addEventListener('DOMContentLoaded', initChatWidget);
        endChatBtn.addEventListener('click', handleEndChat);

    </script>
</body>

</html>